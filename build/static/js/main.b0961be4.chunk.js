(this["webpackJsonpreact-social"]=this["webpackJsonpreact-social"]||[]).push([[0],{105:function(e,t,c){},106:function(e,t,c){},107:function(e,t,c){},108:function(e,t,c){},111:function(e,t,c){},117:function(e,t,c){"use strict";c.r(t);var n=c(1),s=c.n(n),a=c(60),r=c.n(a),i=(c(76),c(11)),o=c(3),l=c.n(o),u=c(12),j=c.n(u),d=function(){var e=Object(i.a)(l.a.mark((function e(t,c){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c({type:"LOGIN_START"}),e.prev=1,e.next=4,j.a.post("https://challenge-chat-api.herokuapp.com/api/auth/login",t);case 4:n=e.sent,c({type:"LOGIN_SUCCESS",payload:n.data}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),c({type:"LOGIN_FAILURE",payload:e.t0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,c){return e.apply(this,arguments)}}(),b=c(8),p=c(29),h=c(30),O=function(e,t){switch(t.type){case"LOGIN_START":return{user:null,isFetching:!0,error:!1};case"LOGIN_SUCCESS":return{user:t.payload,isFetching:!1,error:!1};case"LOGIN_FAILURE":return{user:null,isFetching:!1,error:!0};case"FOLLOW":return Object(h.a)(Object(h.a)({},e),{},{user:Object(h.a)(Object(h.a)({},e.user),{},{followings:[].concat(Object(p.a)(e.user.followings),[t.payload])})});case"UNFOLLOW":return Object(h.a)(Object(h.a)({},e),{},{user:Object(h.a)(Object(h.a)({},e.user),{},{followings:e.user.followings.filter((function(e){return e!==t.payload}))})});default:return e}},x=c(0),m={user:JSON.parse(localStorage.getItem("user"))||null,isFetching:!1,error:!1},f=Object(n.createContext)(m),v=function(e){var t=e.children,c=Object(n.useReducer)(O,m),s=Object(b.a)(c,2),a=s[0],r=s[1];return Object(n.useEffect)((function(){localStorage.setItem("user",JSON.stringify(a.user))}),[a.user]),Object(x.jsx)(f.Provider,{value:{user:a.user,isFetching:a.isFetching,error:a.error,dispatch:r},children:t})},g=c(132);function N(){var e=Object(n.useRef)(),t=Object(n.useRef)(),c=Object(n.useContext)(f),s=c.isFetching,a=c.dispatch;return Object(x.jsx)("div",{className:"login",children:Object(x.jsxs)("div",{className:"loginWrapper",children:[Object(x.jsxs)("div",{className:"loginLeft",children:[Object(x.jsx)("h3",{className:"loginLogo",children:"Social App"}),Object(x.jsx)("span",{className:"loginDesc",children:"Connect with friends and the world around you on Social App."})]}),Object(x.jsx)("div",{className:"loginRight",children:Object(x.jsxs)("form",{className:"loginBox",onSubmit:function(c){c.preventDefault(),d({email:e.current.value,password:t.current.value},a)},children:[Object(x.jsx)("input",{placeholder:"Email",type:"email",required:!0,className:"loginInput",ref:e}),Object(x.jsx)("input",{placeholder:"Password",type:"password",required:!0,minLength:"6",className:"loginInput",ref:t}),Object(x.jsx)("button",{className:"loginButton",type:"submit",disabled:s,children:s?Object(x.jsx)(g.a,{color:"white",size:"20px"}):"Log In"}),Object(x.jsx)("span",{className:"loginForgot",children:"Forgot Password?"}),Object(x.jsx)("button",{className:"loginRegisterButton",onClick:function(e){window.location.href="http://localhost:3000/register"},children:"Create a New Account"})]})})]})})}c(99);var w=c(4);function I(){var e=Object(n.useRef)(),t=Object(n.useRef)(),c=Object(n.useRef)(),s=Object(n.useRef)(),a=Object(w.g)(),r=function(){var n=Object(i.a)(l.a.mark((function n(r){var i;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.preventDefault(),s.current.value===c.current.value){n.next=5;break}s.current.setCustomValidity("Passwords don't match!"),n.next=15;break;case 5:return i={username:e.current.value,email:t.current.value,password:c.current.value},n.prev=6,n.next=9,j.a.post("/auth/register",i);case 9:a.push("/login"),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(6),console.log(n.t0);case 15:case"end":return n.stop()}}),n,null,[[6,12]])})));return function(e){return n.apply(this,arguments)}}();return Object(x.jsx)("div",{className:"login",children:Object(x.jsxs)("div",{className:"loginWrapper",children:[Object(x.jsxs)("div",{className:"loginLeft",children:[Object(x.jsx)("h3",{className:"loginLogo",children:"Social App"}),Object(x.jsx)("span",{className:"loginDesc",children:"Connect with friends and the world around you on social app."})]}),Object(x.jsx)("div",{className:"loginRight",children:Object(x.jsxs)("form",{className:"loginBox",onSubmit:r,children:[Object(x.jsx)("input",{placeholder:"Username",required:!0,ref:e,className:"loginInput"}),Object(x.jsx)("input",{placeholder:"Email",required:!0,ref:t,className:"loginInput",type:"email"}),Object(x.jsx)("input",{placeholder:"Password",required:!0,ref:c,className:"loginInput",type:"password",minLength:"6"}),Object(x.jsx)("input",{placeholder:"Password Again",required:!0,ref:s,className:"loginInput",type:"password"}),Object(x.jsx)("button",{className:"loginButton",type:"submit",children:"Sign Up"}),Object(x.jsx)("button",{className:"loginRegisterButton",onClick:function(e){window.location.href="http://localhost:3000/login"},children:"Log into Account"})]})})]})})}var y=c(39);c(105);function k(e){var t=e.userId,c=Object(n.useState)(),s=Object(b.a)(c,2),a=s[0],r=s[1],o="https://challenge-chat-api.herokuapp.com/images/";return Object(n.useEffect)((function(){var e=function(){var e=Object(i.a)(l.a.mark((function e(){var c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j()("users?userId="+t);case 3:c=e.sent,console.log("user:",c.data),r(c.data),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();e()}),[t]),Object(x.jsx)("div",{className:"chatOnline",children:Object(x.jsxs)("div",{className:"chatOnlineFriend",children:[Object(x.jsxs)("div",{className:"chatOnlineImgContainer",children:[Object(x.jsx)("img",{className:"chatOnlineImg",src:null!==a&&void 0!==a&&a.profilePicture?o+a.profilePicture:o+"person/noAvatar.png",alt:""}),Object(x.jsx)("div",{className:"chatOnlineBadge"})]}),Object(x.jsx)("span",{className:"chatOnlineName",children:null===a||void 0===a?void 0:a.username})]})})}c(106);function S(e){var t=e.conversation,c=e.currentUser,s=Object(n.useState)(),a=Object(b.a)(s,2),r=a[0],o=a[1],u="https://challenge-chat-api.herokuapp.com/images/";return Object(n.useEffect)((function(){var e=t.members.find((function(e){return e!==c._id})),n=function(){var t=Object(i.a)(l.a.mark((function t(){var c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,j()("users?userId="+e);case 3:c=t.sent,o(c.data),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();n()}),[c,t,u]),Object(x.jsxs)("div",{className:"conversation",children:[Object(x.jsx)("img",{className:"conversationImg",src:null!==r&&void 0!==r&&r.profilePicture?u+r.profilePicture:u+"person/noAvatar.png",alt:""}),Object(x.jsx)("span",{className:"conversationName",children:null===r||void 0===r?void 0:r.username})]})}c(107);var L=c(70);function _(e){var t=e.message,c=e.sender,s=e.own,a="https://challenge-chat-api.herokuapp.com/images/",r=Object(n.useState)(),o=Object(b.a)(r,2),u=o[0],d=o[1];return Object(n.useEffect)((function(){var e=function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j()("users?userId="+c);case 3:t=e.sent,d(t.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();e()}),[c]),Object(x.jsxs)("div",{className:s?"message own":"message",children:[Object(x.jsxs)("div",{className:"messageTop",children:[Object(x.jsx)("img",{className:"messageImg",src:null!==u&&void 0!==u&&u.profilePicture?a+u.profilePicture:a+"person/noAvatar.png",alt:""}),Object(x.jsx)("p",{className:"messageText",children:t.text})]}),Object(x.jsx)("div",{className:"messageBottom",children:Object(L.a)(t.createdAt)})]})}c(108);var C=c(133),A=c(134),B=c(135),E=c(136),R=c(65);function F(){var e=Object(n.useContext)(f).user,t="https://challenge-chat-api.herokuapp.com/images/";return Object(x.jsxs)("div",{className:"topbarContainer",children:[Object(x.jsx)("div",{className:"topbarLeft",children:Object(x.jsx)(y.b,{to:"/",style:{textDecoration:"none"},children:Object(x.jsx)("span",{className:"logo",children:"Social App"})})}),Object(x.jsx)("div",{className:"topbarCenter",children:Object(x.jsxs)("div",{className:"searchbar",children:[Object(x.jsx)(C.a,{className:"searchIcon"}),Object(x.jsx)("input",{placeholder:"Search for friend",className:"searchInput"})]})}),Object(x.jsxs)("div",{className:"topbarRight",children:[Object(x.jsxs)("div",{className:"topbarLinks",children:[Object(x.jsx)("span",{className:"topbarLink",children:"Homepage"}),Object(x.jsx)("span",{className:"topbarLink",children:"Timeline"})]}),Object(x.jsxs)("div",{className:"topbarIcons",children:[Object(x.jsxs)("div",{className:"topbarIconItem",children:[Object(x.jsx)(A.a,{}),Object(x.jsx)("span",{className:"topbarIconBadge",children:"1"})]}),Object(x.jsxs)("div",{className:"topbarIconItem",children:[Object(x.jsx)(B.a,{}),Object(x.jsx)("span",{className:"topbarIconBadge",children:"2"})]}),Object(x.jsxs)("div",{className:"topbarIconItem",children:[Object(x.jsx)(E.a,{}),Object(x.jsx)("span",{className:"topbarIconBadge",children:"1"})]})]}),Object(x.jsx)(y.b,{to:"/profile/".concat(e.username),children:Object(x.jsx)("img",{src:e.profilePicture?t+e.profilePicture:t+"person/noAvatar.png",alt:"",className:"topbarImg"})})]})]})}c.n(R).a.config();c(111);var P=c(69);function T(){var e=Object(n.useState)([]),t=Object(b.a)(e,2),c=t[0],s=t[1],a=Object(n.useState)(null),r=Object(b.a)(a,2),o=r[0],u=r[1],d=Object(n.useState)([]),h=Object(b.a)(d,2),O=h[0],m=h[1],v=Object(n.useState)(""),g=Object(b.a)(v,2),N=g[0],w=g[1],I=Object(n.useState)(null),y=Object(b.a)(I,2),L=y[0],C=y[1],A=Object(n.useState)([]),B=Object(b.a)(A,2),E=B[0],R=B[1],T=Object(n.useRef)(),U=Object(n.useContext)(f).user,D=Object(n.useRef)();Object(n.useEffect)((function(){T.current=Object(P.a)("ws://socket-fiacre.herokuapp.com"),console.log("now")}),[]),Object(n.useEffect)((function(){console.log("now again"),T.current.on("getMessage",(function(e){console.log("there is data:",e),C({_id:e._id,sender:e.senderId,text:e.text,createdAt:Date.now()})}))}),[]),Object(n.useEffect)((function(){L&&(null===o||void 0===o?void 0:o.members.includes(L.sender))&&m((function(e){return[].concat(Object(p.a)(e),[L])}))}),[L,o]),Object(n.useEffect)((function(){T.current.emit("addUser",U._id),T.current.on("getUsers",(function(e){var t=e.users,c="61ebe60b2c57850ff8526f68"===U._id?t.filter((function(e){return e.userId!==U._id})):t.filter((function(e){return"61ebe60b2c57850ff8526f68"===e.userId}));console.log(c),R(c)}))}),[U]),Object(n.useEffect)((function(){var e=function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.a.get("/conversations/"+U._id);case 3:t=e.sent,console.log(t.data),s(t.data),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();e()}),[U._id]),Object(n.useEffect)((function(){var e=function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.a.get("/messages/"+(null===o||void 0===o?void 0:o._id));case 3:t=e.sent,m(t.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();e()}),[o]);var M=function(){var e=Object(i.a)(l.a.mark((function e(t){var c,n,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),c={sender:U._id,text:N,conversationId:o._id},e.prev=2,e.next=5,j.a.post("/messages",c);case 5:n=e.sent,m([].concat(Object(p.a)(O),[n.data])),s=o.members.find((function(e){return e!==U._id})),T.current.emit("sendMessage",{_id:n.data._id,senderId:U._id,receiverId:s,text:N}),w(""),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){var e;null===(e=D.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[O]),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(F,{}),Object(x.jsxs)("div",{className:"messenger",children:[Object(x.jsx)("div",{className:"chatMenu",children:Object(x.jsxs)("div",{className:"chatMenuWrapper",children:[Object(x.jsx)("input",{placeholder:"search for friends",className:"chatMenuInput"}),c.map((function(e){return Object(x.jsx)("div",{onClick:function(){return u(e)},children:Object(x.jsx)(S,{conversation:e,currentUser:U})},e._id)}))]})}),Object(x.jsx)("div",{className:"chatBox",children:Object(x.jsx)("div",{className:"chatBoxWrapper",children:o?Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("div",{className:"chatBoxTop",children:O.map((function(e){return Object(x.jsx)("div",{ref:D,children:Object(x.jsx)(_,{message:e,sender:e.sender,own:e.sender===U._id})},e._id)}))}),Object(x.jsxs)("div",{className:"chatBoxBottom",children:[Object(x.jsx)("textarea",{placeholder:"Write something...",className:"chatMessageInput",onChange:function(e){return w(e.target.value)},value:N}),Object(x.jsx)("button",{className:"chatSubmitButton",onClick:M,children:"Send"})]})]}):Object(x.jsx)("span",{className:"noConversationText",children:" Open Conversation to start chat."})})}),Object(x.jsx)("div",{className:"chatOnline",children:Object(x.jsx)("div",{className:"chatOnlineWrapper",children:E?E.map((function(e){return Object(x.jsx)("div",{children:Object(x.jsx)(k,{userId:e.userId})},e.userId)})):Object(x.jsx)("h2",{children:"no online user yet"})})})]})]})}var U=function(){var e=Object(n.useState)(),t=Object(b.a)(e,2),c=t[0],s=t[1],a=function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.a.get("/messages/");case 3:t=e.sent,console.log(t.data),s(t.data),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){a()}),[]);var r=c?c.map((function(e){var t=e._id,c=e.createdAt,n=e.sender,s=e.text,a=e.conversationId;return Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("tr",{className:"odd gradeX",children:[Object(x.jsx)("td",{children:t}),Object(x.jsx)("td",{children:c}),Object(x.jsx)("td",{className:"center",children:n}),Object(x.jsx)("td",{className:"center",children:s}),Object(x.jsx)("td",{className:"center",children:a})]},t)})})):function(){return Object(x.jsx)("p",{children:"no message yet"})};return Object(x.jsx)("div",{className:"row",style:{marginTop:"5rem"},children:Object(x.jsx)("div",{className:"col-md-12",children:Object(x.jsxs)("div",{className:"panel panel-default",children:[Object(x.jsx)("div",{className:"panel-heading",style:{display:"flex",flexDirection:"row",marginBottom:"10px"},children:Object(x.jsx)("h4",{style:{textAlign:"center",marginLeft:"40vw"},children:"Messages List"})}),Object(x.jsx)("div",{className:"panel-body",children:Object(x.jsx)("div",{className:"table-responsive",children:Object(x.jsxs)("table",{className:"table table-striped table-bordered table-hover",style:{width:"80vw",marginRight:"10vw",marginLeft:"10vw"},id:"dataTables-example",children:[Object(x.jsx)("thead",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{children:"id"}),Object(x.jsx)("th",{children:"created at"}),Object(x.jsx)("th",{children:"sender"}),Object(x.jsx)("th",{children:"text"}),Object(x.jsx)("th",{children:"conversation ID"})]})}),Object(x.jsx)("tbody",{children:r})]})})})]})})})};c(116);var D=function(){var e=Object(n.useContext)(f).user;return Object(x.jsx)(y.a,{children:Object(x.jsxs)(w.d,{children:[Object(x.jsx)(w.b,{exact:!0,path:"/",children:e?Object(x.jsx)(T,{}):Object(x.jsx)(N,{})}),Object(x.jsx)(w.b,{path:"/login",children:e?Object(x.jsx)(w.a,{to:"/"}):Object(x.jsx)(N,{})}),Object(x.jsx)(w.b,{path:"/register",children:e?Object(x.jsx)(w.a,{to:"/"}):Object(x.jsx)(I,{})}),Object(x.jsx)(w.b,{path:"/messenger",children:e?Object(x.jsx)(T,{}):Object(x.jsx)(w.a,{to:"/login"})}),Object(x.jsx)(w.b,{path:"/dashboard",children:null!==e&&void 0!==e&&e.isAdmin?Object(x.jsx)(U,{}):Object(x.jsx)(w.a,{to:"/"})})]})})};r.a.render(Object(x.jsx)(s.a.StrictMode,{children:Object(x.jsx)(v,{children:Object(x.jsx)(D,{})})}),document.getElementById("root"))},76:function(e,t,c){},99:function(e,t,c){}},[[117,1,2]]]);
//# sourceMappingURL=main.b0961be4.chunk.js.map